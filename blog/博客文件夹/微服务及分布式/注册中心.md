# 注册中心、服务发现、配置中心

在传统的系统部署中，服务运行在一个固定的已知的 IP 和端口上，如果一个服务需要调用另外一个服务，可以通过地址直接调用，但是，在虚拟化或容器话的环境中，服务实例的启动和销毁是很频繁的，服务地址在动态的变化，如果需要将请求发送到动态变化的服务实例上，至少需要两个步骤：

服务注册 — 存储服务的主机和端口信息

服务发现 — 允许其他用户发现服务注册阶段存储的信息

## 注册中心

在微服务架构中，注册中心是核心的基础服务之一。在微服务架构流行之前，注册中心就已经开始出现在分布式架构的系统中了。

### 什么是注册中心

注册中心可以说是微服务架构中的“通讯录”，它记录了服务和服务地址的映射关系。在分布式架构中，服务会注册到这里，当某一服务需要调用其他的服务时，就会到注册中心中找到服务的地址，再进行调用。

## 服务发现

### 什么是服务发现

服务发现 即允许其他用户发现服务注册阶段存储的信息

服务发现的主要优点是可以无需了解架构的部署拓扑环境，只通过服务的名字就能够使用服务，提供了一种服务发布与查找的协调机制。服务发现除了提供服务注册、目录和查找三大关键特性，还需要能够提供健康监控、多种查询、实时更新和高可用性等。

![image-20220422094521611](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220422094521611.png)

## 配置中心

### 什么是配置

应用程序在启动和运行的时候往往需要读取一些配置信息，配置基本上伴随着应用程序的整个生命周期，比如：数据库连接参数、启动参数等。

配置主要有以下几个特点：

- 配置是独立于程序的只读变量

  ​	配置对于程序是只读的，程序通过读取配置来改变自己的行为，但是程序不应该去改变配置

- 配置伴随应用的整个生命周期

  ​	配置贯穿于应用的整个生命周期，应用在启动时通过读取配置来初始化，在运行时根据配置调整行为。如：启动时需要读取服务的端口号、系统在运行过程中需要读取定时策略执行定时任务等。

- 配置可以有多种加载方式

  ​	常见的有程序内部hard code，配置文件，环境变量，启动参数，基于数据库等

- 配置需要治理

  ​	同一份程序在不同的环境(开发、测试、生产)、不同的集群（如不同的数据中心）经常需有不同的配置，所以需要有完善的环境、集群配置管理

### 什么是配置中心

在微服务架构中，当系统从一个单体应用，被拆分成分布式系统上一个个服务节点后，配置文件也必须跟着迁移（分割），这样配置就分散了，不仅如此，分散中还包含着冗余

![](D:\谭远\typora文件\博客文件夹\图片\服务配置.webp)

下图显示了配置中心的功能，配置中心将配置从各应用中剥离出来，对配置进行统一管理，应用自身不需要自己去管理配置。

![image-20220422095539449](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220422095539449.png)

则配置中心的服务流程就是：

1. 用户在配置中心更新配置信息
2. 配置中心向客户端发送配置更新的通知
3. 客户端获取最新的配置

一个合格的配置中心需要满足如下特性：

1. 配置项容易读取和修改
2. 分布式环境下应用配置的可管理性，即提供远程管理配置的能力
3. 支持对配置的修改的检视以把控风险
4. 可以查看配置修改的历史记录
5. 不同部署环境下应用配置的隔离性
